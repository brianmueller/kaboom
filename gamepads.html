<!DOCTYPE html>
<html>
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
        <!-- <link href="style.css" rel="stylesheet" type="text/css" /> -->
        <style>
            /* CSS */
            
        </style>
        
        <title>Title</title>
    </head>
    <body>
        <!-- HTML -->
        
        
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- <script src="script.js"></script> -->
        <script>
            // JS
            
        </script>

        <script type="module">

            // import kaboom.js
            import kaboom from "https://unpkg.com/kaboom@3000.0.1/dist/kaboom.mjs";

            
            





            kaboom()
            setGravity(2400)
            setBackground(0, 0, 0)
            loadSprite("bean", "https://raw.githubusercontent.com/replit/kaboom/master/sprites/bean.png")
            loadSprite("apple", "https://raw.githubusercontent.com/replit/kaboom/master/sprites/apple.png")

            scene("nogamepad", () => {
                add([
                    text("Gamepad not found.\nConnect a gamepad and press a button!", {
                        width: width() - 80,
                        align: "center",
                    }),
                    pos(center()),
                    anchor("center"),
                ])
                onGamepadConnect(() => {
                    go("game")
                })
            })

            scene("game", () => {

                /*
                const player1 = add([
                    pos(center()),
                    anchor("center"),
                    sprite("bean"),
                    area(),
                    body(),
                ])

                const player2 = add([
                    pos(center()),
                    anchor("center"),
                    sprite("apple"),
                    area(),
                    body(),
                ])
                */

                // Initialize Kaboom.js
                // kaboom();

                // Load assets and create game elements
                const player0 = add([
                    sprite("bean"),
                    pos(80, 80),
                ]);
                const player1 = add([
                    sprite("apple"),
                    pos(120, 80),
                ]);

                const players = [player0, player1];

                // Update function to handle game logic
                function update() {
                // Loop through each connected gamepad
                    for (let i = 0; i < getGamepadCount(); i++) {
                        if (isGamepadConnected(i)) {
                            const gamepad = getGamepad(i);

                            // Check button presses for each button
                            for (let button = 0; button < gamepad.buttons.length; button++) {
                                if (gamepad.buttonPressed(button)) {
                                // Perform actions based on button press
                                    switch (button) {
                                        case 0: // Button A
                                            // Perform action for button A
                                            players[i].jump();
                                            break;
                                        case 1: // Button B
                                            // Perform action for button B
                                            break;
                                        // Add cases for other buttons as needed
                                    }
                                }
                            }
                        }
                    }
                }

                // Example: Player movement controls
                /*
                if (isGamepadConnected(0)) {
                    const gamepad = getGamepad(0);
                    player.move(gamepad.stick(0).add(gamepad.stick(1)).scale(80));
                }
                }
                */

                // Start the game loop
                //start();

                // platform
                add([
                    pos(0, height()),
                    anchor("botleft"),
                    rect(width(), 140),
                    area(),
                    body({isStatic: true}),
                ])
/*
                onGamepadButtonPress((b) => {
                    debug.log(b)
                })

                onGamepadButtonPress("south", () => {
                    player1.jump()
                })

                onGamepadStick("left", (v) => {
                    player1.move(v.x * 400, 0)
                })

                onGamepadDisconnect(() => {
                    go("nogamepad")
                })
*/
            })

            if(getGamepads().length > 0) {
                go("game")
            } else {
                go("nogamepad")
            }




        </script>
    </body>
</html>